mapboxgl.accessToken = 'pk.eyJ1IjoiYml0c2FuZGF0b21zIiwiYSI6ImNqbDhvZnl1YjB4NHczcGxsbTF6bWRjMWQifQ.w2TI_q7ClI4JE5I7QU3hEA';
var map = new mapboxgl.Map({
    container: 'map',
    style: "mapbox://styles/mapbox/light-v9",
    zoom: 0
});


map.on('load', function() {

    // starting view
    var mapCoordinates = [40.7400, -74.0501];
    var mapZoom = 13;


     /* 2 THE HEIGHTS -- NEIGHBORHOOD BOUNDARIES

    map.addSource("neighborhoodmap", {
            type: 'geojson',
            data: {
"type": "FeatureCollection",
"name": "heights_geojson",
"crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
"features": [
{ "type": "Feature", "properties": { "NAME": "The Heights", "AREA": 78826212.694000006, "ACRES": 1809.601 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -74.051582830669986, 40.731180241383605 ], [ -74.052026831351938, 40.731357663882044 ], [ -74.052643957056503, 40.73173604010114 ], [ -74.053655911837197, 40.732643438630326 ], [ -74.056428450408532, 40.735050314606625 ], [ -74.057272020959374, 40.735777460078005 ], [ -74.058709869895367, 40.7370063123427 ], [ -74.059252719279897, 40.737474155833851 ], [ -74.059612176284077, 40.737784170181982 ], [ -74.05990557229002, 40.738043426432434 ], [ -74.06066876697318, 40.738663618439908 ], [ -74.061828009428879, 40.739644456847884 ], [ -74.06256285624012, 40.740253406730915 ], [ -74.066418414574528, 40.74108437328502 ], [ -74.075939954608373, 40.742959585069883 ], [ -74.075910069357761, 40.743058748752581 ], [ -74.075787414084161, 40.743077580262955 ], [ -74.075774595346232, 40.74310002910785 ], [ -74.075732077172489, 40.743141651034598 ], [ -74.075634773342344, 40.743160575568041 ], [ -74.075503483369118, 40.74320829840412 ], [ -74.075405975012629, 40.743259359075893 ], [ -74.075371886635338, 40.743304225587096 ], [ -74.075380051070852, 40.743349247540444 ], [ -74.075430631888906, 40.743368715862275 ], [ -74.075068230457774, 40.743878361801087 ], [ -74.074941655017525, 40.743848972354911 ], [ -74.07488176393349, 40.743964445264034 ], [ -74.074749346060088, 40.744188917011236 ], [ -74.074676880658672, 40.744288274938079 ], [ -74.074510330884181, 40.744564039936101 ], [ -74.074445803357179, 40.744743769660822 ], [ -74.074322120089519, 40.744923281185116 ], [ -74.074545389680154, 40.745030156757359 ], [ -74.07449411148832, 40.745119951529645 ], [ -74.074414013308157, 40.745090732843607 ], [ -74.074294431761984, 40.74528954169395 ], [ -74.074269058820676, 40.745292661813629 ], [ -74.074233902915267, 40.745504636802252 ], [ -74.074271931710499, 40.745504777080228 ], [ -74.07410183046261, 40.746336499590804 ], [ -74.074038099769623, 40.746390897415047 ], [ -74.073907233029757, 40.746371132123663 ], [ -74.073889613209133, 40.746483546802729 ], [ -74.073906125431236, 40.746544668186004 ], [ -74.073897141154418, 40.746628191385177 ], [ -74.073875664975361, 40.746682745105396 ], [ -74.073841450719144, 40.746746892907737 ], [ -74.073777555280131, 40.746826999625569 ], [ -74.073738643397093, 40.746965045291162 ], [ -74.073774580198275, 40.747292976032618 ], [ -74.073881387468703, 40.748434235944458 ], [ -74.073998432959016, 40.748633917749814 ], [ -74.074107724986177, 40.748724304842284 ], [ -74.074212853172142, 40.748805035353683 ], [ -74.074347028279476, 40.748969429230776 ], [ -74.074464383384154, 40.749120906114307 ], [ -74.074446394967183, 40.749291166155906 ], [ -74.074512633122737, 40.749506728594241 ], [ -74.074768904869472, 40.749742273520162 ], [ -74.075024973824583, 40.750009954169194 ], [ -74.076416790270301, 40.751101302702047 ], [ -74.076614321441056, 40.751272353803998 ], [ -74.076752977724567, 40.751398196819366 ], [ -74.076824042038524, 40.751520578151592 ], [ -74.076840435916324, 40.751600980856018 ], [ -74.076903354529293, 40.751675126712982 ], [ -74.076992015153081, 40.751688306513429 ], [ -74.076996098404805, 40.75171081740546 ], [ -74.076974887856011, 40.751723594480275 ], [ -74.07685656498586, 40.751723160735253 ], [ -74.076784664972706, 40.751732538218 ], [ -74.076475956015415, 40.75176675653789 ], [ -74.076150527125591, 40.751771989297055 ], [ -74.075939358659525, 40.751751931385357 ], [ -74.075724066643986, 40.751715789410397 ], [ -74.0755173695525, 40.751657182719434 ], [ -74.075180245476972, 40.751508111949775 ], [ -74.074051545022172, 40.750906202979067 ], [ -74.073781999057701, 40.750763804905226 ], [ -74.073748377719483, 40.750734757402739 ], [ -74.073718961637965, 40.750708939126504 ], [ -74.073693935523323, 40.750657427424606 ], [ -74.07368177140394, 40.750577039889222 ], [ -74.07361438835612, 40.749879417118429 ], [ -74.073517197297363, 40.749879058020149 ], [ -74.073453401117348, 40.749943096354841 ], [ -74.073545274694311, 40.750775785277064 ], [ -74.073570321267979, 40.750824083381517 ], [ -74.073595449994642, 40.750859526967588 ], [ -74.073645892269496, 40.750901491469406 ], [ -74.073746941185647, 40.750959711381356 ], [ -74.073907048493226, 40.751034217773004 ], [ -74.075347396588384, 40.751804387821039 ], [ -74.076069216014631, 40.751932375843175 ], [ -74.076783605398916, 40.751899646925466 ], [ -74.076956925449124, 40.751890641235597 ], [ -74.077003287355211, 40.751910093384261 ], [ -74.077019783366794, 40.751974427914348 ], [ -74.077032073937474, 40.752035533325888 ], [ -74.07704854964291, 40.752103081479703 ], [ -74.076925816929844, 40.752131554976295 ], [ -74.076820109740169, 40.752140808548099 ], [ -74.076629844880628, 40.752156179281577 ], [ -74.076477592148933, 40.752174902899455 ], [ -74.076342324310332, 40.752180833851021 ], [ -74.076143566725676, 40.752202600014321 ], [ -74.076004011714801, 40.752218155934891 ], [ -74.075936520658416, 40.752198625753735 ], [ -74.075894282614698, 40.752195256848644 ], [ -74.075851983310642, 40.752201528813302 ], [ -74.075822239001241, 40.752227129126503 ], [ -74.07582201434775, 40.752262479038365 ], [ -74.075771038612288, 40.75230406982196 ], [ -74.075474493080861, 40.752418672746913 ], [ -74.075376909853503, 40.752479374129777 ], [ -74.075236658743862, 40.75260419246866 ], [ -74.075177046544979, 40.752674674529423 ], [ -74.07512564049749, 40.752783751204937 ], [ -74.075103795051362, 40.752896150389326 ], [ -74.075128434398977, 40.753008720700471 ], [ -74.075153278386821, 40.753089154728677 ], [ -74.075215746542113, 40.753234001290359 ], [ -74.075291097222518, 40.753346758194333 ], [ -74.075358118982109, 40.753440202186617 ], [ -74.075437777835404, 40.753540120031751 ], [ -74.075504943068125, 40.753611068545581 ], [ -74.075777831377508, 40.753894877741693 ], [ -74.075874436082174, 40.753988430160483 ], [ -74.075946011957868, 40.754030471299863 ], [ -74.076210778383413, 40.754262830377591 ], [ -74.076290419087556, 40.754365961258543 ], [ -74.076353298869051, 40.754446534644394 ], [ -74.07641558731406, 40.754620303187231 ], [ -74.07646148188789, 40.754713668979697 ], [ -74.076460890459472, 40.754806864168827 ], [ -74.076426511282875, 40.754896721655875 ], [ -74.076392254398101, 40.754967297368481 ], [ -74.076328476458016, 40.755028123598457 ], [ -74.076256327959186, 40.755076064252336 ], [ -74.076146165481106, 40.755120651558435 ], [ -74.075905057060325, 40.755155116554192 ], [ -74.075579529868122, 40.755173202124617 ], [ -74.075418797447981, 40.755195106844731 ], [ -74.075236791565189, 40.755239428960166 ], [ -74.075088389166893, 40.755316011526595 ], [ -74.074952562237073, 40.755408708723046 ], [ -74.074880207636269, 40.755488784768211 ], [ -74.074837414802474, 40.755572183373225 ], [ -74.074790272945222, 40.755674848146825 ], [ -74.074743069509083, 40.75578715377636 ], [ -74.074721140477848, 40.755912407325141 ], [ -74.074749596788607, 40.756089265748543 ], [ -74.07481184159775, 40.756269462345621 ], [ -74.074907895658669, 40.756449783437226 ], [ -74.074991169524822, 40.756646125885602 ], [ -74.075036470010005, 40.75683268734786 ], [ -74.075060946935466, 40.756970966606431 ], [ -74.075055759008521, 40.757121991437323 ], [ -74.075008063793206, 40.757311424149286 ], [ -74.074969168619887, 40.757446256335996 ], [ -74.074908937645461, 40.757613146926431 ], [ -74.074852912091941, 40.757783266672341 ], [ -74.074809708210935, 40.757930937721973 ], [ -74.074745434483177, 40.758068890016965 ], [ -74.074685673462426, 40.758161867102359 ], [ -74.074587978646392, 40.75823863583485 ], [ -74.07439301876164, 40.758324686934159 ], [ -74.074202325625677, 40.758404326044278 ], [ -74.073952505665929, 40.758477319181857 ], [ -74.074011242256134, 40.758545023693721 ], [ -74.073393224067644, 40.758696998477049 ], [ -74.073270724284029, 40.75868690450141 ], [ -74.07308464567808, 40.758705498525671 ], [ -74.072966145966973, 40.758730769719449 ], [ -74.072851872426952, 40.758756056432922 ], [ -74.072690924718927, 40.758810093526812 ], [ -74.072576589188614, 40.758845020836148 ], [ -74.072508474845961, 40.75892189734251 ], [ -74.072444421896392, 40.759024498449072 ], [ -74.072363092913676, 40.759184882093699 ], [ -74.072331799423239, 40.75945150317451 ], [ -74.072309349668643, 40.759657096725959 ], [ -74.072265211926265, 40.759949379758211 ], [ -74.072192663713707, 40.760058376617067 ], [ -74.072145700019959, 40.760132117592683 ], [ -74.071744871517907, 40.760287125665108 ], [ -74.071738298097571, 40.760290449864883 ], [ -74.070860036212949, 40.76075611119964 ], [ -74.070518328163658, 40.760959180405379 ], [ -74.068595648722535, 40.761837483989432 ], [ -74.067733533094611, 40.762168013909687 ], [ -74.067329809602825, 40.76226185983262 ], [ -74.067042316913884, 40.762390197151454 ], [ -74.066584224097042, 40.762579195261608 ], [ -74.066233757191611, 40.762748162086552 ], [ -74.065991050241323, 40.76287666509058 ], [ -74.065703286334127, 40.763045866078848 ], [ -74.065406074912062, 40.7632899555135 ], [ -74.065243942534593, 40.763425571663731 ], [ -74.065126688669054, 40.76354773401939 ], [ -74.06494694980718, 40.763635604018745 ], [ -74.064615011711552, 40.763709276971539 ], [ -74.064382056761843, 40.763715209233382 ], [ -74.064140410654929, 40.763680240161676 ], [ -74.06391469790681, 40.763584404339369 ], [ -74.063640405818447, 40.763426331128223 ], [ -74.063212559461647, 40.763097768299808 ], [ -74.062829685667921, 40.762742128875217 ], [ -74.062606718908171, 40.762591434551794 ], [ -74.062285528793495, 40.762392687911792 ], [ -74.062142783212934, 40.762303598988936 ], [ -74.061847396034381, 40.762268421210408 ], [ -74.061650411761406, 40.762254050500552 ], [ -74.061372761750633, 40.762246184241469 ], [ -74.06095138213783, 40.76229907268344 ], [ -74.060530226182792, 40.762317903731784 ], [ -74.060297096257216, 40.76235107245283 ], [ -74.060108576042481, 40.762411656109713 ], [ -74.059901735298055, 40.762533471662437 ], [ -74.05982926302309, 40.762655799405429 ], [ -74.059828319394228, 40.762798833957085 ], [ -74.05989017152379, 40.76292848531434 ], [ -74.059925104958879, 40.763064845332359 ], [ -74.059950338937497, 40.76313591571293 ], [ -74.059973439885539, 40.763267064290154 ], [ -74.059980453312221, 40.763321757974587 ], [ -74.059931322539413, 40.763480360774018 ], [ -74.059868032010414, 40.763568666833692 ], [ -74.059751577089315, 40.763568222648587 ], [ -74.059394198858584, 40.763423820663952 ], [ -74.058929641001015, 40.763231328618602 ], [ -74.058688360018778, 40.763141858810513 ], [ -74.058795360716772, 40.763217192662609 ], [ -74.058974160987262, 40.763272366797111 ], [ -74.059206349788298, 40.763382235298984 ], [ -74.059474461541527, 40.763478617781587 ], [ -74.059599514685871, 40.763533585774141 ], [ -74.059653038311964, 40.763567846707879 ], [ -74.059679507962031, 40.763629249757166 ], [ -74.05966965083428, 40.763765438935238 ], [ -74.05957061717659, 40.763839985766914 ], [ -74.059542528779616, 40.764023784724159 ], [ -74.05959443417656, 40.76430324770223 ], [ -74.059629008038485, 40.764494097112966 ], [ -74.059708328246487, 40.764691928567032 ], [ -74.059769822312006, 40.76487606928638 ], [ -74.059876197935935, 40.765046758464486 ], [ -74.059901724813443, 40.765251195943037 ], [ -74.059962905438155, 40.765483014709027 ], [ -74.059871704505028, 40.765727875066482 ], [ -74.059754481714279, 40.765843220678285 ], [ -74.059610203494188, 40.765985708274513 ], [ -74.059466014610933, 40.766114573354109 ], [ -74.059294949881718, 40.766243335621262 ], [ -74.059228053332077, 40.766285289494341 ], [ -74.059133022984753, 40.76634488719472 ], [ -74.058854545584936, 40.766459615748438 ], [ -74.058692797722117, 40.766533922039706 ], [ -74.058548921383704, 40.766615107802288 ], [ -74.058413913014093, 40.766709949987735 ], [ -74.058296550682229, 40.766845727565808 ], [ -74.058161406151925, 40.766961002935716 ], [ -74.058044133109846, 40.767083157921498 ], [ -74.057962558468134, 40.767225883531012 ], [ -74.05787211517999, 40.767354952433053 ], [ -74.057745430768875, 40.767545184395097 ], [ -74.057618655294988, 40.767749038530354 ], [ -74.057527849202984, 40.76793259643113 ], [ -74.057401207892866, 40.768116016824898 ], [ -74.05733720937566, 40.768200178392021 ], [ -74.057256603270773, 40.768306179492782 ], [ -74.05713000571842, 40.768482788409642 ], [ -74.057066661463764, 40.76857790397235 ], [ -74.056993453600995, 40.768809208296062 ], [ -74.056809495261604, 40.768927867831813 ], [ -74.055619270325423, 40.766786912090637 ], [ -74.052119081615714, 40.760912840145245 ], [ -74.05190986437627, 40.760554679722681 ], [ -74.051789797318321, 40.760426738355953 ], [ -74.051642178048567, 40.760309138608363 ], [ -74.05135238134217, 40.760082318721963 ], [ -74.049913348573355, 40.759514571125912 ], [ -74.0497984875594, 40.759430532862254 ], [ -74.04968103375424, 40.759323497044605 ], [ -74.049528516743251, 40.759118105691265 ], [ -74.049257098874008, 40.758613414602131 ], [ -74.049076382937756, 40.758514490092701 ], [ -74.043664864879943, 40.756585233327336 ], [ -74.042603917325508, 40.752800113922866 ], [ -74.042433902235047, 40.752492777783068 ], [ -74.042174935946292, 40.752248664880746 ], [ -74.038957231691583, 40.751024364899344 ], [ -74.038874074569307, 40.750978956489796 ], [ -74.038840117123456, 40.750911504698408 ], [ -74.03884055635352, 40.750847930123314 ], [ -74.03872302756514, 40.750776404558259 ], [ -74.037875635458747, 40.750286158489921 ], [ -74.037660608217024, 40.750161086074911 ], [ -74.037880073411003, 40.74987322547311 ], [ -74.038016937930053, 40.749655202776125 ], [ -74.038612341623889, 40.748307387955649 ], [ -74.038867323173932, 40.747938346654173 ], [ -74.039004104496726, 40.74779666771898 ], [ -74.039046050601684, 40.747733185595479 ], [ -74.039121175120385, 40.747634494049095 ], [ -74.039156987679831, 40.747577163597249 ], [ -74.039190551642449, 40.747518794758953 ], [ -74.039241564935011, 40.747416232552155 ], [ -74.039295739012388, 40.747280571294361 ], [ -74.039401909663923, 40.747030513711827 ], [ -74.039458911482541, 40.746909961155055 ], [ -74.039503489477482, 40.746824529351606 ], [ -74.039561527630696, 40.746717191134707 ], [ -74.039625823909788, 40.746618284490239 ], [ -74.039653853568581, 40.746577221280852 ], [ -74.039707123138882, 40.746507093115 ], [ -74.039795622863224, 40.746398503752161 ], [ -74.039842459044351, 40.746345334616699 ], [ -74.039975450985438, 40.746196262218966 ], [ -74.040180662758146, 40.745976622035982 ], [ -74.040315167259422, 40.745836991213366 ], [ -74.040406941112195, 40.745744026655437 ], [ -74.040678216333916, 40.745462886083445 ], [ -74.04075727232042, 40.745382223132303 ], [ -74.040834072318432, 40.745301551150668 ], [ -74.040871104635528, 40.745263268450614 ], [ -74.040909721933687, 40.745224134284818 ], [ -74.040939012832922, 40.745196286032645 ], [ -74.041017831901002, 40.745117166008427 ], [ -74.041131505068734, 40.744988431373336 ], [ -74.041201382220677, 40.744897437905244 ], [ -74.04123923234576, 40.744838570822672 ], [ -74.041263404375684, 40.7448005799789 ], [ -74.04126548479185, 40.744794779384989 ], [ -74.041271453679173, 40.744778137303136 ], [ -74.041279054341047, 40.744755349652557 ], [ -74.041285978102593, 40.744732559311139 ], [ -74.041292676419587, 40.74470976816103 ], [ -74.041298699132071, 40.744686802685976 ], [ -74.041304045176915, 40.744663834521269 ], [ -74.041307074267266, 40.744649778447773 ], [ -74.041443167353904, 40.744540862259008 ], [ -74.041451788358387, 40.744533690902223 ], [ -74.041463719460083, 40.744504401129426 ], [ -74.041466323207842, 40.744486568962067 ], [ -74.041454747568949, 40.744431279746912 ], [ -74.041444210846009, 40.744356093526186 ], [ -74.041438173658079, 40.744282640696746 ], [ -74.0414395625167, 40.744211790820422 ], [ -74.041444759509702, 40.744177670583547 ], [ -74.041457749470027, 40.744125567154654 ], [ -74.041487778353826, 40.744055860452598 ], [ -74.041506950936153, 40.744023168143627 ], [ -74.041526537020772, 40.74399596747778 ], [ -74.041595347827013, 40.743928645138297 ], [ -74.041645596024225, 40.743870856461506 ], [ -74.041714206936547, 40.743799758855658 ], [ -74.041765835438071, 40.743738029741891 ], [ -74.041890847060188, 40.743567134906797 ], [ -74.041949639585368, 40.743480386018419 ], [ -74.041973787290502, 40.743445826216018 ], [ -74.042026939324828, 40.743359226454118 ], [ -74.042117253807902, 40.743182188932785 ], [ -74.04219746458287, 40.74299824884104 ], [ -74.042219367144597, 40.742929195995103 ], [ -74.042227733191098, 40.742893372591389 ], [ -74.04223562460767, 40.742860978513697 ], [ -74.042246609791746, 40.742772152599699 ], [ -74.042255621616249, 40.74268879722262 ], [ -74.042258186702767, 40.742667174096248 ], [ -74.042258203310524, 40.742667126637642 ], [ -74.042258222993127, 40.742666960458656 ], [ -74.042283054591692, 40.742457308116116 ], [ -74.04227497248273, 40.742385905991881 ], [ -74.042257783811465, 40.74226094019501 ], [ -74.042241949769718, 40.742135808213767 ], [ -74.042230390511932, 40.742045177271223 ], [ -74.042218726716271, 40.741969814979832 ], [ -74.04218419135087, 40.741710103657311 ], [ -74.042164032202635, 40.741557847569624 ], [ -74.042155045996196, 40.741453844904392 ], [ -74.042161555777795, 40.741425562847837 ], [ -74.042170064975565, 40.741401749417903 ], [ -74.042188422497588, 40.741356186576091 ], [ -74.042212380105056, 40.741316307500888 ], [ -74.042250348151583, 40.741272709584116 ], [ -74.04229528010076, 40.741233256775374 ], [ -74.042313422291855, 40.741219089045458 ], [ -74.042358983878131, 40.741186501216681 ], [ -74.042402003198376, 40.741162824507775 ], [ -74.042514289750713, 40.74110339429361 ], [ -74.04255550920891, 40.741079024185993 ], [ -74.042613628246656, 40.741045767066474 ], [ -74.042727611482931, 40.740980542918507 ], [ -74.042771325962491, 40.740954123821254 ], [ -74.042776780088772, 40.740950720804676 ], [ -74.04286012580117, 40.740898717729984 ], [ -74.04286029210725, 40.740900100465005 ], [ -74.042860728730616, 40.740898840634628 ], [ -74.042954341186899, 40.740842989823101 ], [ -74.043106157541445, 40.740742197306638 ], [ -74.043193652753487, 40.740679580091033 ], [ -74.043273052511424, 40.740613327923988 ], [ -74.043330292483091, 40.740555051574326 ], [ -74.043342128173933, 40.740539486138573 ], [ -74.043492462878291, 40.740424276018679 ], [ -74.043568073243705, 40.740351317787187 ], [ -74.043612025011612, 40.740290072102084 ], [ -74.043659258607818, 40.740199521365277 ], [ -74.043828138390893, 40.74037446609853 ], [ -74.044114574360975, 40.740477317902879 ], [ -74.044944971161399, 40.739834372961553 ], [ -74.045056223550375, 40.739670264290922 ], [ -74.045111757828721, 40.739601672507142 ], [ -74.045202141043958, 40.73961399575348 ], [ -74.04557229013335, 40.738975215274081 ], [ -74.046244666876248, 40.737849963736629 ], [ -74.046616535616025, 40.737534297525272 ], [ -74.046717806859675, 40.737435429214052 ], [ -74.046794671954871, 40.737409804656437 ], [ -74.046862928022222, 40.737397109446036 ], [ -74.047666976294707, 40.736946551353441 ], [ -74.048760348978405, 40.735291541449769 ], [ -74.048293417647116, 40.73503693264815 ], [ -74.048516971673763, 40.734739653644205 ], [ -74.04875782772227, 40.734403552220861 ], [ -74.049024461927289, 40.734035142981654 ], [ -74.049290743273133, 40.733718584542139 ], [ -74.048832210008101, 40.733483455464089 ], [ -74.049277682444924, 40.733128707675888 ], [ -74.050279989030415, 40.732328898336725 ], [ -74.050725664053203, 40.731941737633484 ], [ -74.051248234074308, 40.731522466126023 ], [ -74.051582830669986, 40.731180241383605 ] ] ] ] } }
]
}

        });

    map.addLayer({
        "id": "neighborhood",
        "type": "fill",
        "source": "neighborhoodmap",
        "paint": {
            "fill-color": "grey",
            "fill-opacity": 0.5,
        }

    });

    */

     // THE HEIGHTS -- NEIGHBORHOOD BOUNDARIES

    var boundaries_url = ("/static/maps/heights_boundaries.geojson");

    map.addSource("neighborhoodmap", {
            type: 'geojson',
            data: boundaries_url
        });

    map.addLayer({
        "id": "neighborhood",
        "type": "fill",
        "source": "neighborhoodmap",
        "paint": {
            "fill-color": "grey",
            "fill-opacity": 0.5,
        }

    });



    // ROUTES
    var waypoints_geojson = {
        'type': 'geojson',
        'data': passed_citywide_waypoints_geojson
    };

    map.addSource('waypoints_geojson', waypoints_geojson);

    map.addLayer({
        "id": "route",
        "type": "line",
        "source": "waypoints_geojson",
        "paint": {
            "line-color": "blue",
            "line-opacity": 0.5,
            "line-width": 3
        }

    });

    // STOPS
    var stops_geojson = {
        type: 'geojson',
        data: passed_citywide_stops_geojson
    };

    map.addSource('stops_geojson', stops_geojson);

    map.addLayer({
        "id": "stops",
        "type": "circle",
        "source": "stops_geojson",
        "paint": {
            "circle-radius": 2,
            "circle-opacity": 1,
            "circle-stroke-width": 1,
            "circle-stroke-color": "#fff"
        }
    });


    // VEHICLES
    var routelistArray=passed_reportcard_routes;

    for(let j=0; j<routelistArray.length; j++) {

        var url = ('/api/v1/positions?period=now&rt='+routelistArray[j].route);

        map.addSource('vehicles_geojson'+routelistArray[j].route, {
            type: 'geojson',
            data: url
        });

        map.addLayer({
        "id": "vehicles"+routelistArray[j].route,
        "type": "circle",
        "source": "vehicles_geojson"+routelistArray[j].route,
        "paint": {
            "circle-radius": 4,
            "circle-opacity": 1,
            "circle-stroke-width": 3,
            "circle-stroke-color": "#f6c"
        }
        })

    };


    window.setInterval(function() {

        for(let j=0; j<routelistArray.length; j++) {
            var url = ('/api/v1/positions?period=now&rt='+routelistArray[j].route);
            map.getSource('vehicles_geojson'+routelistArray[j].route).setData(url);
            }
    }, 1000);

    // setup the viewport
    map.jumpTo({
        'center': [-74.0501, 40.7400],
        'zoom': 12
    });


    /*
    // ZOOM TO THE EXTENT
    // based on https://www.mapbox.com/mapbox-gl-js/example/zoomto-linestring/

    // todo zoom to extent of ALL lines (not just [n] in below)
    var coordinates = waypoints_geojson.data.features[3].geometry.coordinates;
    var bounds = coordinates.reduce(function(bounds, coord) {
      return bounds.extend(coord);
    }, new mapboxgl.LngLatBounds(coordinates[0], coordinates[0]));
    map.fitBounds(bounds, { padding: 20 });



    // ZOOM TO THE EXTENT of THE HEIGHTS --- not working
    // based on https://www.mapbox.com/mapbox-gl-js/example/zoomto-linestring/

    var coordinates = neighborhoodmap.data.features[0].geometry.coordinates;
    var bounds = coordinates.reduce(function(bounds, coord) {
      return bounds.extend(coord);
    }, new mapboxgl.LngLatBounds(coordinates[0], coordinates[0]));
    map.fitBounds(bounds, { padding: 20 });
    */


    // HOVER TOOLTIPS

    for(let j=0; j<routelistArray.length; j++) {


        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        map.on('mouseenter', ('vehicles'+routelistArray[j].route), function(e) {
            // Change the cursor style as a UI indicator.
            map.getCanvas().style.cursor = 'pointer';

            var coordinates = e.features[0].geometry.coordinates.slice();
            var description = (e.features[0].properties.fs + ", Bus " + e.features[0].properties.id + ", Driver " + e.features[0].properties.op + ", Run " + e.features[0].properties.run);

            // Ensure that if the map is zoomed out such that multiple
            // copies of the feature are visible, the popup appears
            // over the copy being pointed to.
            while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
            }

            // Populate the popup and set its coordinates
            // based on the feature found.
            popup.setLngLat(coordinates)
                .setHTML(description)
                .addTo(map);
        });

        map.on('mouseleave', ('vehicles'+routelistArray[j].route), function() {
            map.getCanvas().style.cursor = '';
            popup.remove();
        });

    }




});
