{%- extends "base.html" %}


{# Loads some of the macros included with Flask-Bootstrap. We are using the
   utils module here to automatically render Flask's flashed messages in a
   bootstrap friendly manner #}
{% import "bootstrap/utils.html" as utils %}


{# Inside the ``content`` is where you should place most of your own stuff.
   This will keep scripts at the page end and a navbar you add on later
   intact. #}
{% block head %}
<META HTTP-EQUIV="refresh" CONTENT="60">

    <!-- seems to have no effect --> <style> #map { width:100%; } </style>

{{ super() }}
{% endblock %}

{% block scripts %}

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="{{ url_for('static', filename='mdb/css/bootstrap.min.css')}}" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="{{ url_for('static', filename='mdb/css/mdb.min.css')}}" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="{{ url_for('static', filename='mdb/css/style.min.css')}}" rel="stylesheet">


    <script type="text/javascript">
        var passed_route = {{ routereport.route }}
        var passed_waypoints_geojson = {{ routereport.waypoints_geojson|safe }}
        var passed_stops_geojson = {{ routereport.stops_geojson|safe }}
    </script>

    </script>
    <script type="text/javascript" src="{{ url_for('static', filename='maps/busmap-route.js')}}"></script>
{% endblock %}


{% block content_main %}


    <!--Main layout-->
    <main class="mt-2 pt-5">
        <div class="container">


            <!--Section: Menu-->

                <section id="menu" class="text-center">

                <!-- Content -->
                <div class="card-body text-black text-center mt-4 ">

                    <h1 class="mb-4">
                        <strong>{{routereport.routename}}</strong>
                    </h1>

                    <p class="mb-4">
                        <strong>{{routereport.description_long}}</strong>
                    </p>
                    <a target="_self" href="#current_service" class="btn btn-outline-black btn-lg">Current Service
                        <i class="fas fa-graduation-cap ml-2"></i>
                    </a>
                    <a target="_self" href="#route_performance" class="btn btn-outline-black btn-lg">Route Performance
                        <i class="fas fa-map ml-2"></i>
                    </a>
                    <a target="_self" href="#stops" class="btn btn-outline-black btn-lg">Stops
                        <i class="fas fa-pencil-alt ml-2"></i>
                    </a>

                </div>
                <!-- Content -->
            </section>
            <!--Section: Menu-->



            <!--Section: Arrivals-->
            <section id="current_service">
                     <h1 class="mb-4 mt-4">
                        <strong>On the Road Now</strong>
                    </h1>



                <!--Grid row-->
                <div class="row mb-4 wow fadeIn">

                    <!--Map column-->


                     <div  class="col-lg-4 col-md-12">
                        <div id="map" class="container">
                        </div>
                    </div>


                    {% for trip in routereport.active_trips %}

                    <!--Grid column-->
                    <div class="col-lg-4 col-md-12 mb-4">

                        <!--Card-->
                        <div class="card">

                            <!--Card image-->
                            <!--
                            <div class="view overlay">
                                <div class="embed-responsive embed-responsive-16by9 rounded-top">
                                    <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/cXTThxoywNQ" allowfullscreen></iframe>
                                </div>
                            </div>
                            -->

                            <!--Card content-->
                            <div class="card-body">
                                <!--Title-->
                                <h4 class="card-title">Bus {{ trip.trip_id | split_(0) }}</h4>
                                <!--
                                <h4 class="card-title">{{trip.trip_id}}</h4>
                                -->
                                <!--Text-->
                                <div id="buses" class="row mt-2">


                                    <table class="table table-sm table-hover">
                                                <thead class="thread-dark">
                                                <tr>
                                                    <th>Arrival</th>
                                                    <th>Stop</th>
                                                </tr>
                                                </thead>

                                                <tbody>
                                                {% for stop in trip.trip_card %}
                                                {%if stop.arrival_timestamp != none %}


                                                    <tr class='table-success'>

                                                <tr class='table text-left'>

                                                    <td>{{stop.arrival_timestamp|strftime_today}}</td>
                                                    <td>{{stop.stop_name|title}}</td>
                                                </tr>
                                                {% endif %}

                                                {% endfor %}

                                                </tbody>
                                    </table>

                                </div>




                            </div>

                        </div>
                        <!--/.Card-->


                    </div>
                    <!--Grid column-->


                    {% endfor %}



                </div>
                <!--Grid row-->


            </section>
            <!--Section: Arrivals-->


            <hr id="route_performance" class="my-5">


            <!--Section: Route Performance-->
            <section  class="text-center">
                     <h1 class="mb-4">
                        <strong>Route Performance</strong>
                    </h1>
                <!--Grid row-->
                <div class="row mb-4 wow fadeIn">

                    <!--Grid column-->
                    <div class="col-lg-4 col-md-12 mb-4">

                        <!--Card-->
                        <div class="card">

                            <!--Card image-->
                            <!--
                            <div class="view overlay">
                                <div class="embed-responsive embed-responsive-16by9 rounded-top">
                                    <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/cXTThxoywNQ" allowfullscreen></iframe>
                                </div>
                            </div>
                            -->

                            <!--Card content-->
                            <div class="card-body">
                                <!--Title-->
                                <h4 class="card-title">Card</h4>

                                <div id="buses" class="row mt-2">


                                </div>




                            </div>

                        </div>
                        <!--/.Card-->


                    </div>
                    <!--Grid column-->





                </div>
                <!--Grid row-->


            </section>
            <!--Section: Route Performance-->

            <hr id="stops" class="my-5">

            <!--Section: Stops-->
            <section id="stops" class="text-center">
                     <h1 class="mb-4">
                        <strong>Stops</strong>
                    </h1>
                    <p class="mb-4">
                        <strong>The following is complete list of stops on the {{routereport.route}}, grouped by direction and service. Click on a stop for a detailed report of current and past service at that location.</strong>
                    </p>

                <!--Grid row-->
                <div class="row mb-4 wow fadeIn">







                    {% for path in routereport.route_stop_list %}
                    <!--Grid column-->
                    <div class="col-lg-4 col-md-12 mb-4">

                        <!--Card-->
                        <div class="card">

                            <!--Card image-->
                            <!--
                            <div class="view overlay">
                                <div class="embed-responsive embed-responsive-16by9 rounded-top">
                                    <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/cXTThxoywNQ" allowfullscreen></iframe>
                                </div>
                            </div>
                            -->

                            <!--Card content-->
                            <div class="card-body">
                                <!--Title-->
                                <h4 class="card-title">To {{path.dd}}</h4>

                                <div id="buses" class="row mt-2">

                                    {% for stop in path.stops %}
                                    <a href = {{url_for('genStopReport',source=routereport.source,route=routereport.route,stop=stop.identity,period='daily') }} id="{{stop.st}}">
                                            <span class="label">{{stop.st|title}} </span>
                                    </a>
                                    {% endfor %}

                                </div>


                            </div>

                        </div>
                        <!--/.Card-->


                    </div>
                    <!--Grid column-->
                    {% endfor %}


                </div>
                <!--Grid row-->


            </section>
            <!--Section: Stops-->





        </div>


    </main>
    <!--Main layout-->


{% endblock %}
