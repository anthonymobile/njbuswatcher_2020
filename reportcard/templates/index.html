{# This simple template derives from ``base.html``. See ``base.html`` for
   more information about template inheritance. #}
{%- extends "base.html" %}

{# Loads some of the macros included with Flask-Bootstrap. We are using the
   utils module here to automatically render Flask's flashed messages in a
   bootstrap friendly manner #}
{% import "bootstrap/utils.html" as utils %}


{# Inside the ``content`` is where you should place most of your own stuff.
   This will keep scripts at the page end and a navbar you add on later
   intact. #}


{% block scripts %}

<script src='//d3js.org/d3.v3.min.js' charset='utf-8'></script>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiYml0c2FuZGF0b21zIiwiYSI6ImNqbDhvZnl1YjB4NHczcGxsbTF6bWRjMWQifQ.w2TI_q7ClI4JE5I7QU3hEA';
var map = new mapboxgl.Map({
    container: 'map',
    style: "mapbox://styles/mapbox/light-v9",
    zoom: 0
});


map.on('load', function() {

    // starting view
    var mapCoordinates = [40.7400, -74.0501];
    var mapZoom = 13;

    // ROUTES

    var waypoints_geojson = {
        type: 'geojson',
        data: {
            "type": "Feature",
            "properties": {},
            "geometry": {{citywide_waypoints | safe}}
        }
    };

    map.addSource('waypoints_geojson', waypoints_geojson);

    map.addLayer({
        "id": "route",
        "type": "line",
        "source": "waypoints_geojson",
        "paint": {
            "line-color": "blue",
            "line-opacity": 0.75,
            "line-width": 5
        }

    });


    // STOPS

        var stops_geojson = {
        type: 'geojson',
        data: {
            "type": "Feature",
            "properties": {},
            "geometry": {{citywide_stops | safe}}
        }
    };

    map.addSource('stops_geojson', stops_geojson);

    map.addLayer({
        "id": "stops",
        "type": "circle",
        "source": "stops_geojson",
        "paint": {
            "circle-radius": 2,
            "circle-opacity": 1,
            "circle-stroke-width": 2,
            "circle-stroke-color": "#fff"
        }
    });


    // VEHICLES

    map.addSource('vehicles_geojson', {
        type: 'geojson',
        data: '/api/v1/positions?period=now&rt={{routereport.route}}'
    });


    map.addLayer({
        "id": "vehicles",
        "type": "circle",
        "source": "vehicles_geojson",
        "paint": {
            "circle-radius": 4,
            "circle-opacity": 1,
            "circle-stroke-width": 3,
            "circle-stroke-color": "#f6c"
        }

    });



    // setup the viewport
    map.jumpTo({
        'center': [-74.0501, 40.7400],
        'zoom': 12
    });

    // ZOOM TO THE EXTENT
    // based on https://www.mapbox.com/mapbox-gl-js/example/zoomto-linestring/

    var coordinates = stops_geojson.data.geometry.coordinates;
    var bounds = coordinates.reduce(function(bounds, coord) {
      return bounds.extend(coord);
    }, new mapboxgl.LngLatBounds(coordinates[0], coordinates[0]));
    map.fitBounds(bounds, { padding: 20 });


});

</script>

{% endblock %}

{% block content %}

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">


  <link href="static/mdb/css/bootstrap.min.css" rel="stylesheet">

  <link href="static/mdb/css/mdb.min.css" rel="stylesheet">

  <link href="static/mdb/css/style.min.css" rel="stylesheet">
  <style type="text/css">
    html,
    body,
    header,
    .view {
      height: 100%;
    }

    @media (max-width: 740px) {
      html,
      body,
      header,
      .view {
        height: 1000px;
      }
    }

    @media (min-width: 800px) and (max-width: 850px) {
      html,
      body,
      header,
      .view {
        height: 650px;
      }
    }
    @media (min-width: 800px) and (max-width: 850px) {
              .navbar:not(.top-nav-collapse) {
                  background: #1C2331!important;
              }
          }
  </style>

        <!--
        <div class="container py-2">
          <div class="row">
            <div class="col-md-12">
              <h1>some pages are slow to load. we're working a speed-up.</h1>
            </div>
          </div>
        </div>
        -->

  <!-- Full Page Intro -->
  <div class="view full-page-intro" style="background-image: url('static/images/banner.jpg'); background-repeat: no-repeat; background-size: cover;">

    <!-- Mask & flexbox options-->
    <div class="mask rgba-black-light d-flex justify-content-center align-items-center">

      <!-- Content -->
      <div class="container">



        <!--Grid row-->
        <div class="row wow fadeIn">

          <!--Grid column-->
          <div class="col-md-6 mb-4 white-text text-center text-md-left">

            <h1 class="display-4 font-weight-bold">Buses are the backbone of <br> Jersey City's neighborhoods.</h1>

            <hr class="hr-light">

            <h2>
              <strong>We depend on buses every day to get to work, school, and back home again.</strong>  But its hard to evaluate the quality of bus service. That's why we built this site to provide a one-stop shop for bus performance information.
            </h2>

            <a target="_blank" href="#reportcards" class="btn btn-indigo btn-lg">Go to the report cards
              <i class="fa fa-graduation-cap ml-2"></i>
            </a>

          </div>
          <!--Grid column-->

          <!--Grid column-->
          <div class="col-md-6 col-xl-5 mb-4">



          </div>
          <!--Grid column-->

        </div>
        <!--Grid row-->

      </div>
      <!-- Content -->

    </div>
    <!-- Mask & flexbox options-->

  </div>
  <!-- Full Page Intro -->

  <!--Main layout-->
  <main>
    <div class="container">


      <!--Section: Routes-->
      <section>

        <h2 class="my-5 h3 text-center"><u>Click</u> on a route below to view the reports.</h2>

        <!--First row-->
        <div id="reportcards" class="row features-small mt-5 wow fadeIn">

                    {% for route in reportcard_routes %}
                        <div class="col-md-3">
                           <div class="container">
                            <a href = {{ url_for('genRouteReport' ,source='nj',route=route.route) }}>
                                <h1 class="display-3 text-center">{{route.route}}</h1>
                            </a>

                            <!--
                            {% if (route.grade=='A' or route.grade=='B') %}
                                <p class="lead text-center text-success">Current Grade: {{route.grade}}</h1>
                            {% endif %}
                            {% if route.grade=='C' %}
                                <p class="lead text-center text-warning">Current Grade: {{route.grade}}</p>
                            {% endif %}
                            {% if (route.grade=='D' or route.grade=='F') %}
                                <p class="lead text-center text-danger">Current Grade: {{route.grade}}</p>
                            {% endif %}
                            -->

                           <p class="lead text-left">{{route.description_short}}</p>

                            <!-- <p class="lead text-left">{{route.description_short}}</p> -->
                           </div>
                        </div>
                      {% endfor %}



      </section>
      <!--Section: More-->

    </div>
  </main>
  <!--Main layout-->

  <!--Footer-->
  <footer class="page-footer text-center font-small mt-4 wow fadeIn">

    <!--Call to action-->
    <div class="pt-4">


      <a class="btn btn-outline-white" href="https://goo.gl/forms/VF5S1Oclk9QTdZha2" target="_blank" role="button">Sign the Petition for Better Bus Service
        <i class="fa fa-download ml-2"></i>
      </a>

    </div>
    <!--/.Call to action-->



<div id="map"></div>

    <hr class="my-4">


    <!--Copyright-->
    <div class="footer-copyright py-3">
      Â© 2018 Site concept and design by
      <a href="http://www.bitsandatoms.net" target="_blank"> Bits and Atoms</a> for Code4JC. Source: <a href="https://github.com/code4jc/buswatcher" target="_blank">GitHub</a>.
    </div>
    <!--/.Copyright-->

  </footer>
  <!--/.Footer-->

  <!-- SCRIPTS -->
  <!-- JQuery -->
  <script type="text/javascript" src="static/mdb/js/jquery-3.3.1.min.js"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="static/mdb/js/popper.min.js"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="static/mdb/js/bootstrap.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="static/mdb/js/mdb.min.js"></script>
  <!-- Initializations -->
  <script type="text/javascript">
    // Animations initialization
    new WOW().init();
  </script>

{%- endblock %}