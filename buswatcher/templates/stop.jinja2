{# todo 1 finish stop page layout

    - row 1
        - left = grade card, 4 boxes
            - **qualitative grade** based on period: "SERVICE IS {good|fair|poor} {period}." --> "SERVICE IS GOOD
            - **frequency** Same as headway but labelled, presented a little differently.
            - **travel time** from here to the last stop for {period}
            - **travel speed** merge with one of the others, or separate box. a little bit of bling. average for last arrival over its most recent n stops?
            - **bunching** same as route
        - right = small map
    - row 2
        - hourly detail tables
        - left = **frequency/headway by hour** average for {period}
        - right = **arrivals** with bunching highlights for {period}
        - borrow code from current `main` branch
#}


{%- extends "base.jinja2" %}


{# Loads some of the macros included with Flask-Bootstrap. We are using the
   utils module here to automatically render Flask's flashed messages in a
   bootstrap friendly manner #}
{% import "bootstrap/utils.html" as utils %}


{# Inside the ``content`` is where you should place most of your own stuff.
   This will keep scripts at the page end and a navbar you add on later
   intact. #}
{% block head %}
<META HTTP-EQUIV="refresh" CONTENT="60">

{{ super() }}
{% endblock %}



{% block breadcrumb %}
<li class="breadcrumb-item"><a href={{ url_for('genRouteReport' ,source='nj',route=routereport.route, period='now') }}>{{routereport.route}} {{routereport.prettyname}}</a></li>

<li class="breadcrumb-item active"><a href={{url_for('genStopReport',source=routereport.source,route=routereport.route,stop=stop.stop_id,period='daily') }}>{{stopreport.stop_name|title}}</a></li>

{% endblock %}}


{% block sticky_nav %}

<nav class="navbar navbar-expand-sm sticky-top navbar-light bg-white">
    <div class="container">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbar1">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbar1">
            <ul class="navbar-nav">
                <li class="breadcrumb-item active"><a href = {{url_for('displayHome')}}>home</a></li>
             </ul>
            <ul class="navbar-nav ml-auto">
                <li class="breadcrumb-item "><a href = {{url_for('genStopReport',source=routereport.source,route=routereport.route,stop=stopreport.stop,period='now')}}>now</a></li>
                <li class="breadcrumb-item "><a href = {{url_for('genStopReport',source=routereport.source,route=routereport.route,stop=stopreport.stop,period='today')}}>today</a></li>
                <li class="breadcrumb-item "><a href = {{url_for('genStopReport',source=routereport.source,route=routereport.route,stop=stopreport.stop,period='yesterday')}}>yesterday</a></li>
                <li class="breadcrumb-item "><a href = {{url_for('genStopReport',source=routereport.source,route=routereport.route,stop=stopreport.stop,period='history')}}>history</a></li>

		        <!--<li class="breadcrumb-item "><a href = {{url_for('genStopReport',source=routereport.source,route=routereport.route,stop=stopreport.stop,period='yesterday')}}>yesterday</a></li>-->
                <!--<li class="breadcrumb-item "><a href = {{url_for('genRStopReport',source=routereport.source,route=routereport.route,stop=stopreport.stop,period='history')}}>history</a></li>-->

            </ul>
        </div>
    </div>
</nav>


{% endblock %}





{% block scripts %}

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="{{ url_for('static', filename='mdb/css/bootstrap.min.css')}}" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="{{ url_for('static', filename='mdb/css/mdb.min.css')}}" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="{{ url_for('static', filename='mdb/css/style.min.css')}}" rel="stylesheet">


    <script type="text/javascript">
        var passed_reportcard_routes = {{ reportcard_routes|safe }}
        var passed_route = {{ routereport.route }}
        var passed_stop_id  = {{ stopreport.stop|safe }}
    </script>

    </script>
    <script type="text/javascript" src="{{ url_for('static', filename='maps/busmap-stop.js')}}"></script>

    <!-- zoom to extent stuff -->
    <script src='https://api.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>



{% endblock %}


{% block content_main %}


    <!--Main layout-->
    <main class="mt-2 pt-5">
        <div class="container">


            <!--Section: Menu-->
            <section id="menu" class="text-center">

                <!-- Content -->
                <div class="card-body text-black text-center mt-4 ">

                    <h3 class="mb-4">
                       {{routereport.route}} {{routereport.prettyname}} <strong>{{stopreport.stop_name|title}}</strong>
                    </h3>

                </div>
                <!-- Content -->

            </section>
            <!--Section: Menu-->




            <!--Section: Stop Performance-->
            <section  class="text-left">


                <!--Grid row-->
                <div class="row mb-4 wow fadeIn">

                    <!--Grid column-->
                    <div class="col-lg-4 col-md-12 mb-4">

                        <!--Card-->
                        <div class="card mb-4">

                            <!--Card image-->
                            <!--
                            <div class="view overlay">
                                <div class="embed-responsive embed-responsive-16by9 rounded-top">
                                    <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/cXTThxoywNQ" allowfullscreen></iframe>
                                </div>
                            </div>
                            -->

                            <!--Card content-->
                            <div class="card-body">
                                <!--Title-->
                                <h4 class="card-title">Buses are running every x minutes.</h4>
                                That's x.

                            </div>

                        </div>
                        <!--/.Card-->

                        <!--Card-->
                        <div class="card mb-4">

                            <!--Card image-->
                            <!--
                            <div class="view overlay">
                                <div class="embed-responsive embed-responsive-16by9 rounded-top">
                                    <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/cXTThxoywNQ" allowfullscreen></iframe>
                                </div>
                            </div>
                            -->

                            <!--Card content-->
                            <div class="card-body">
                                <!--Title-->
                                <h4 class="card-title">Buses are running every x minutes.</h4>
                                That's x.

                            </div>

                        </div>
                        <!--/.Card-->
                    </div>

                    <!--Grid column-->
                    <div class="col-lg-4 col-md-12 mb-4">

                        <!--Card-->
                        <div class="card mb-4">

                            <!--Card image-->
                            <!--
                            <div class="view overlay">
                                <div class="embed-responsive embed-responsive-16by9 rounded-top">
                                    <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/cXTThxoywNQ" allowfullscreen></iframe>
                                </div>
                            </div>
                            -->

                            <!--Card content-->
                            <div class="card-body">
                                <!--Title-->
                                <h4 class="card-title">Buses are running every x minutes.</h4>
                                That's x.

                            </div>

                        </div>
                        <!--/.Card-->

                        <!--Card-->
                        <div class="card mb-4">

                            <!--Card image-->
                            <!--
                            <div class="view overlay">
                                <div class="embed-responsive embed-responsive-16by9 rounded-top">
                                    <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/cXTThxoywNQ" allowfullscreen></iframe>
                                </div>
                            </div>
                            -->

                            <!--Card content-->
                            <div class="card-body">
                                <!--Title-->
                                <h4 class="card-title">Buses are running every x minutes.</h4>
                                That's x.

                            </div>

                        </div>
                        <!--/.Card-->
                    </div>


                    <!--Grid column-->
                    <div class="col-lg-4 col-md-12 mb-4">
                        <div id="map" class="container">
                        </div>
                    </div>


                </div>
            </section>



            <hr id="arrivals" class="my-5">

            <!--Section: Arrivals-->
            <section id="one">

                <!--Grid row-->
                <div class="row mb-4 wow fadeIn">

                    <h1 class="mb-4 mt-4">
                        <strong>What Stops Here?</strong>
                    </h1>

                        <p>
                            The {{routereport.route}} stops at {{stopreport.stop_name|title}} but so do other routes. Here are all the arrivals we saw during the following period: <strong>{{period}}</strong>.

                     </p>
                </div>

                <!--Grid row-->
                <div class="row mb-4 wow fadeIn">

                    <!--Grid column-->
                    <div class="col-lg-4 col-md-12 mb-4">



                        <!--Card-->
                        <div class="card">

                            <!--Card content-->
                            <div class="card-body">
                                <!--Title-->
                                <h4 class="card-title">84 New York</h4>

                                <!--Text-->
                                <div id="buses" class="row mt-2">



                                             <table class="table table-sm table-hover">
                                                <thead class="thread-dark">
                                                  <tr>
                                                    <th>hour</th>
                                                    <th>bus every</th>
                                                  </tr>
                                                </thead>
                                                <tbody>

                                                {% for (index,row) in stopreport.hourly_frequency.iterrows() %}
                                                    <tr class='table'>
                                                        <td>{{row.hour|hour_as_int}}</td>
                                                        {% if row.frequency != row.frequency %}
                                                            <td>- - -</td>
                                                        {% else %}
                                                            <td>{{row.frequency|int}} mins</td>
                                                        {% endif %}
                                                    </tr>
                                                {% endfor %}

                                                </tbody>
                                              </table>


                                </div>




                            </div>

                        </div>
                        <!--/.Card-->


                    </div>
                    <!--Grid column-->

                    <!--Grid column-->
                    <div class="col-lg-4 col-md-12 mb-4">

                        <!--Card-->
                        <div class="card">

                            <!--Card content-->
                            <div class="card-body">
                                <!--Title-->
                                <h4 class="card-title">86 North Bergen</h4>

                                <!--Text-->
                                <div id="buses" class="row mt-2">



                                             <table class="table table-sm table-hover">
                                                <thead class="thread-dark">
                                                  <tr>
                                                    <th>hour</th>
                                                    <th>bus every</th>
                                                  </tr>
                                                </thead>
                                                <tbody>

                                                {% for (index,row) in stopreport.hourly_frequency.iterrows() %}
                                                    <tr class='table'>
                                                        <td>{{row.hour|hour_as_int}}</td>
                                                        {% if row.frequency != row.frequency %}
                                                            <td>- - -</td>
                                                        {% else %}
                                                            <td>{{row.frequency|int}} mins</td>
                                                        {% endif %}
                                                    </tr>
                                                {% endfor %}

                                                </tbody>
                                              </table>


                                </div>




                            </div>

                        </div>
                        <!--/.Card-->


                    </div>
                    <!--Grid column-->

                    <!--Grid column-->
                    <div class="col-lg-4 col-md-12 mb-4">

                        <!--Card-->
                        <div class="card">

                            <!--Card content-->
                            <div class="card-body">
                                <!--Title-->
                                <h4 class="card-title">87 Hoboken</h4>

                                <!--Text-->
                                <div id="buses" class="row mt-2">



                                             <table class="table table-sm table-hover">
                                                <thead class="thread-dark">
                                                  <tr>
                                                    <th>hour</th>
                                                    <th>bus every</th>
                                                  </tr>
                                                </thead>
                                                <tbody>

                                                {% for (index,row) in stopreport.hourly_frequency.iterrows() %}
                                                    <tr class='table'>
                                                        <td>{{row.hour|hour_as_int}}</td>
                                                        {% if row.frequency != row.frequency %}
                                                            <td>- - -</td>
                                                        {% else %}
                                                            <td>{{row.frequency|int}} mins</td>
                                                        {% endif %}
                                                    </tr>
                                                {% endfor %}

                                                </tbody>
                                              </table>


                                </div>




                            </div>

                        </div>
                        <!--/.Card-->


                    </div>
                    <!--Grid column-->


                </div>
                <!--Grid row-->



                <hr id="frequency" class="my-5">

                <!--Grid row-->
                <div class="row mb-4 wow fadeIn">


                    <!--Grid column-->
                    <div id="frequency" class="col-lg-12 col-md-12 mb-4">

                         <h1 class="mb-4 mt-4">
                            <strong>How Often Do Buses Come?</strong>
                        </h1>

                        <p class="head">
                        <mark>Service Frequency</mark> is one important measure of how good bus service is at your corner.
                        </p>
                        <p>
                            Below, see how often {{routereport.route}} buses serve {{stopreport.stop_name|title}}. This average is calculated over the following period: <strong>{{period}}</strong>.

                        </p>

                        <!--Card-->
                        <div class="card">

                            <!--Card image-->
                            <!--
                            <div class="view overlay">
                                <div class="embed-responsive embed-responsive-16by9 rounded-top">
                                    <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/cXTThxoywNQ" allowfullscreen></iframe>
                                </div>
                            </div>
                            -->

                            <!--Card content-->
                            <div class="card-body">
                                <!--Title-->
                                <h4 class="card-title">some title here - stop?</h4>

                                <!--Text-->
                                <div id="buses" class="row mt-2">



                                             <table class="table table-sm table-hover">
                                                <thead class="thread-dark">
                                                  <tr>
                                                    <th>hour</th>
                                                    <th>bus every</th>
                                                  </tr>
                                                </thead>
                                                <tbody>

                                                {% for (index,row) in stopreport.hourly_frequency.iterrows() %}
                                                    <tr class='table'>
                                                        <td>{{row.hour|hour_as_int}}</td>
                                                        {% if row.frequency != row.frequency %}
                                                            <td>- - -</td>
                                                        {% else %}
                                                            <td>{{row.frequency|int}} mins</td>
                                                        {% endif %}
                                                    </tr>
                                                {% endfor %}

                                                </tbody>
                                              </table>


                                </div>




                            </div>

                        </div>
                        <!--/.Card-->


                    </div>
                    <!--Grid column-->



                </div>
                <!--Grid row-->


                <hr id="bunching" class="my-5">


                 <!--Grid row-->
                <div class="row mb-4 wow fadeIn">

                    <!--Grid column-->
                    <div id="bunching" class="col-lg-12 col-md-12 mb-4">

                        <h1 class="mb-4 mt-4">
                            <strong>How Much Bunching Is Going On?</strong>
                        </h1>

                        <p class="head">
                         <mark>Bunching</mark> occurs when a bus arrives at a stop within 3 minutes or less of the previous bus, and leads to more irregular service, with some buses overcrowded and others virtually empty. Bunching has many causes-some of which can't be controlled-but more can be done. Red arrival times indicate a bus that bunched too close to the one ahead.
                        </p>

                        <!--Card-->
                        <div class="card">

                            <!--Card image-->
                            <!--
                            <div class="view overlay">
                                <div class="embed-responsive embed-responsive-16by9 rounded-top">
                                    <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/cXTThxoywNQ" allowfullscreen></iframe>
                                </div>
                            </div>
                            -->

                            <!--Card content-->
                            <div class="card-body">
                                <!--Title-->
                                <h4 class="card-title">title something</h4>

                                <!--Text-->
                                <div id="buses" class="row mt-2">



                                             <table class="table table-sm table-hover">
                                                <thead>
                                                  <tr>
                                                    <th>time</th>
                                                    <th>interval</th>
                                                      <th>bus</th>
                                                  </tr>
                                                </thead>
                                                <tbody>
                                                {% for (index,row) in stopreport.arrivals_list_final_df.iterrows() %}
                                                    {% if (row.delta > stopreport.bigbang) and (row.delta <= stopreport.bunching_interval) %}
                                                        <tr class='table-danger'>
                                                            <td>{{row.arrival_timestamp|strftime_period(period)}}</td>
                                                            <td>{{row.delta|strftime_timedelta}}</td>
                                                                                    <td>{{row.v}}</td>
                                                        </tr>
                                                    {% else %}
                                                        <tr>
                                                            <td>{{row.arrival_timestamp|strftime_period(period)}}</td>

                                                            <td>{{row.delta|strftime_timedelta}}</td>
                                                            <td>{{row.v}}</td>
                                                        </tr>
                                                    {% endif %}
                                                {% endfor %}
                                                </tbody>
                                              </table>



                                </div>




                            </div>

                        </div>
                        <!--/.Card-->


                    </div>
                    <!--Grid column-->


                 </div>
                <!--Grid row-->




            </section>
            <!--Section: Arrivals-->


        </div>


    </main>
    <!--Main layout-->


{% endblock %}
